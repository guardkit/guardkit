---
id: TASK-PDI-003
title: Enrich pattern files with codebase-specific examples
status: completed
created: 2025-12-12T11:45:00Z
updated: 2025-12-12T15:15:00Z
completed: 2025-12-12T15:15:00Z
priority: medium
tags: [progressive-disclosure, patterns, template-create, enhancement]
complexity: 5
parent_review: TASK-REV-PD01
implementation_mode: task-work
previous_state: in_review
state_transition_reason: "Task completed - all acceptance criteria met"
completed_location: tasks/completed/TASK-PDI-003/
quality_gates:
  compilation: passed
  tests_passing: 62/62 (100%)
  line_coverage: 78%
  code_review_score: 82/100
organized_files:
  - TASK-PDI-003.md
  - completion-report.md
---

# Task: Enrich pattern files with codebase-specific examples

## Description

Pattern files in `.claude/rules/patterns/` currently contain minimal stub content generated by `/template-create`. Enhance these files with actual code examples extracted from the source codebase.

## Problem

Current pattern files have generic content:
```markdown
# Repository

## Overview
Mediates between domain and data mapping layers

## Example
No examples found in codebase.
```

Should include actual examples:
```markdown
# Repository

## Overview
Mediates between domain and data mapping layers using ErrorOr railway-oriented programming.

## Example

From `DriverRepository.cs`:
```csharp
public async Task<ErrorOr<DriverDetails>> GetDriverDetails()
{
    var result = await _realmAccessor.ExecuteReadAsync<DriverDetails>(
        realm => realm.All<RealmDriver>().FirstOrDefault()
            ?? AppErrors.Driver.GetFailed,
        AppErrors.Driver.DatabaseError);

    return result.IsError ? result.Errors : result.Value;
}
```

## Best Practices
- Always use IRealmAccessor for thread-safe operations
- Return ErrorOr<T> for consistent error handling
- Materialize queries with ToList() before mapping
```

## Acceptance Criteria

- [x] All 12 pattern files have real code examples
- [x] Examples are extracted from the source codebase
- [x] Best practices section populated with template-specific guidance
- [x] Pattern files remain concise (<1KB each)
- [x] `/template-create` updated to extract examples during generation

## Implementation Summary

### Files Created
1. **`installer/core/lib/pattern_generator.py`** (~483 lines)
   - `PatternExampleExtractor` class for extracting code examples
   - `CodeExample` dataclass for representing extracted examples
   - `extract_pattern_examples()` convenience function
   - Supports Python, TypeScript, C#, Java, Go, Rust, Ruby, PHP

2. **`tests/unit/test_pattern_generator.py`** (~314 lines)
   - 18 test cases covering extraction logic
   - Tests for multiple languages and pattern types
   - Edge case and boundary testing

### Files Modified
1. **`installer/core/lib/template_generator/rules_structure_generator.py`**
   - Added `file_samples` parameter to `__init__`
   - Added pattern example extraction during initialization
   - Modified `_generate_pattern_rules()` to use extracted examples
   - Added helper methods: `_build_examples_section()`, `_build_best_practices_from_examples()`

### Key Features
- Reuses existing `PatternCategoryDetector` (follows DRY principle)
- Smart code extraction (prefers methods over constructors)
- Language-aware syntax highlighting
- Automatic best practices detection (async/await, ErrorOr, interfaces)
- Graceful fallback when no examples found

## Notes

- Medium priority - improves developer experience
- Implemented Option A: Automatic extraction during `/template-create`
- Code review score: 82/100 (APPROVED WITH MINOR RECOMMENDATIONS)
- All 62 tests pass (100% pass rate)
