---
id: TASK-FIX-PD02
title: Fix manifest.json requires field language detection
status: completed
created: 2025-12-07T12:05:00Z
updated: 2025-12-07T14:35:00Z
completed: 2025-12-07T14:35:00Z
completed_location: tasks/completed/TASK-FIX-PD02/
priority: high
tags: [template-create, manifest, bug-fix]
complexity: 3
related_tasks: [TASK-REV-TC02]
test_results:
  status: passed
  coverage: 73
  last_run: 2025-12-07T14:30:00Z
---

# Task: Fix Manifest.json Requires Field Language Detection

## Description

The manifest.json generated by `/template-create` incorrectly sets the `requires` field to `typescript-domain-specialist` for JavaScript projects.

**Current (incorrect)**:
```json
"requires": [
  "agent:typescript-domain-specialist"
]
```

**Expected**:
- For JavaScript projects: Should reference appropriate JS specialist or be empty
- For TypeScript projects: Can reference typescript-domain-specialist

## Root Cause

The manifest generation logic doesn't check the detected language before setting the requires field.

## Acceptance Criteria

- [x] Manifest requires field matches detected project language
- [x] JavaScript projects don't reference TypeScript specialists
- [x] TypeScript projects correctly reference TypeScript specialists
- [ ] Re-run template-create on kartlog produces correct requires field (requires manual verification)

## Files Modified

- `installer/global/lib/template_creation/manifest_generator.py` - Line 547-549: Split TypeScript/JavaScript condition
- `tests/unit/test_manifest_generator.py` - Added two new test methods

## Implementation Summary

**Fix Applied**: Split the combined TypeScript/JavaScript condition to only add `typescript-domain-specialist` for TypeScript projects. JavaScript projects now receive an empty `requires` array since no JavaScript-specific domain specialist exists.

**Code Change** (manifest_generator.py:547-549):
```python
# Before:
elif lang in ["typescript", "javascript"]:
    requirements.append("agent:typescript-domain-specialist")

# After:
elif lang == "typescript":
    requirements.append("agent:typescript-domain-specialist")
# JavaScript: No specialist agent exists, so no requirement added
```

**Tests Added**:
1. `test_extract_requirements_javascript()` - Verifies JS projects don't get TS specialist
2. `test_extract_requirements_typescript()` - Verifies TS projects get TS specialist

## Test Results

All 38 tests passed including the 2 new tests.

## Test Plan

1. Run `/template-create` on a JavaScript project
2. Verify manifest.json requires field is appropriate for JS
3. Run `/template-create` on a TypeScript project
4. Verify manifest.json requires field references typescript-domain-specialist

## Related

- Review: TASK-REV-TC02
