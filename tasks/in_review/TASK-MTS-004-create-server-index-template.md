---
complexity: 4
conductor_workspace: mcp-ts-wave2-1
created: 2026-01-24 16:45:00+00:00
dependencies:
- TASK-MTS-001
feature_id: FEAT-MTS
id: TASK-MTS-004
implementation_mode: task-work
parallel_group: wave2
parent_review: TASK-REV-4371
priority: high
status: in_review
tags:
- template
- mcp
- typescript
- server
task_type: feature
title: Create server/index.ts.template
updated: 2026-01-28 19:15:00+00:00
wave: 2
---

# Task: Create server/index.ts.template

## Description

Create the main server entry point template for MCP TypeScript projects. This is the most critical template as it establishes the correct patterns for server initialization, tool registration, and transport connection.

## Reference

Use `.claude/reviews/TASK-REV-4371-review-report.md` Section 3 for code patterns.
Use `docs/research/mcp-server-best-practices-2025.md` for TypeScript examples.

## Acceptance Criteria

- [ ] File created at `installer/core/templates/mcp-typescript/templates/server/index.ts.template`
- [ ] Uses McpServer from @modelcontextprotocol/sdk/server/mcp.js
- [ ] Uses StdioServerTransport from @modelcontextprotocol/sdk/server/stdio.js
- [ ] Imports Zod for schema validation
- [ ] Registers example tool BEFORE server.connect()
- [ ] Uses console.error() for logging (NEVER console.log)
- [ ] Includes proper TypeScript types
- [ ] Placeholders:
  - {{ServerName}}: Server identifier (kebab-case)
  - {{ServerVersion}}: Version string (default: 1.0.0)
  - {{Description}}: Server description

## Template Content

```typescript
/**
 * {{ServerName}} - MCP Server
 * {{Description}}
 *
 * Generated by GuardKit mcp-typescript template
 */

import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import * as z from 'zod';

// Initialize MCP server
const server = new McpServer({
    name: '{{ServerName}}',
    version: '{{ServerVersion}}'
});

// Register tools BEFORE calling connect()
// Example tool - replace with your implementations
server.registerTool(
    'hello-world',
    {
        title: 'Hello World',
        description: 'A simple greeting tool',
        inputSchema: {
            name: z.string().describe('Name to greet')
        }
    },
    async ({ name }) => ({
        content: [{
            type: 'text',
            text: `Hello, ${name}!`
        }]
    })
);

// Connect via STDIO transport
async function main() {
    const transport = new StdioServerTransport();
    await server.connect(transport);

    // CRITICAL: Log to stderr only (stdout = MCP protocol)
    console.error('{{ServerName}} started successfully');
}

main().catch((error) => {
    console.error('Fatal error:', error);
    process.exit(1);
});
```

## Critical Patterns Encoded

1. **McpServer class** - Not raw Server
2. **Tool registration before connect()** - Order matters
3. **stderr logging** - console.error only
4. **Zod validation** - Type-safe schemas
5. **Proper async/await** - Error handling

## Test Execution Log

**Execution Date**: 2026-01-28
**Development Mode**: TDD (test-driven development)
**Workflow**: implement-only

### TDD RED Phase
- Created 24 tests in `tests/templates/mcp-typescript/test_server_index_template.py`
- Tests covered: file existence, imports, placeholders, logging, tool registration order, async patterns, TypeScript patterns, Zod usage
- Initial result: All tests FAILING (template not yet created)

### TDD GREEN Phase
- Created template at `installer/core/templates/mcp-typescript/templates/server/index.ts.template`
- Result: All 24 tests PASSING

### Test Results
```
Total Tests: 24
Passed: 24 (100%)
Failed: 0
Execution Time: 1.26s
```

### Test Classes
1. TestTemplateExists (2 tests) ✅
2. TestRequiredImports (3 tests) ✅
3. TestRequiredPlaceholders (5 tests) ✅
4. TestLoggingPattern (2 tests) ✅
5. TestToolRegistrationOrder (2 tests) ✅
6. TestAsyncMainFunction (5 tests) ✅
7. TestTypeScriptPatterns (3 tests) ✅
8. TestZodSchemaUsage (2 tests) ✅

### Code Review
- **Score**: 95/100
- **Status**: APPROVED
- **Critical Issues**: 0
- **MCP Pattern Compliance**: 5/5

### Acceptance Criteria Status
- [x] File created at correct path
- [x] Uses McpServer from @modelcontextprotocol/sdk/server/mcp.js
- [x] Uses StdioServerTransport from @modelcontextprotocol/sdk/server/stdio.js
- [x] Imports Zod for schema validation
- [x] Registers example tool BEFORE server.connect()
- [x] Uses console.error() for logging (NEVER console.log)
- [x] Includes proper TypeScript types
- [x] All placeholders present: {{ServerName}}, {{ServerVersion}}, {{Description}}