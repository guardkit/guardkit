---
id: TASK-SP-005
title: Implement architecture markdown writer with Jinja2 templates
status: in_progress
task_type: feature
parent_review: TASK-REV-DBBC
feature_id: FEAT-SP-001
wave: 2
implementation_mode: task-work
complexity: 5
dependencies:
- TASK-SP-001
tags:
- system-plan
- templates
- markdown
- jinja2
autobuild_state:
  current_turn: 1
  max_turns: 25
  worktree_path: /Users/richardwoollcott/Projects/appmilla_github/guardkit/.guardkit/worktrees/FEAT-6EDD
  base_branch: main
  started_at: '2026-02-09T12:10:32.867475'
  last_updated: '2026-02-09T12:21:00.009465'
  turns:
  - turn: 1
    decision: approve
    feedback: null
    timestamp: '2026-02-09T12:10:32.867475'
    player_summary: Implementation via task-work delegation
    player_success: true
    coach_success: true
---

# Task: Implement Architecture Markdown Writer with Jinja2 Templates

## Description

Create the markdown output generation layer that produces architecture documentation files from entity data. Uses Jinja2 templates for rendering and handles methodology-aware content (DDD vs modular).

## Acceptance Criteria

- [ ] `ArchitectureWriter` class with `write_all(output_dir, system, components, concerns, decisions)` method
- [ ] Jinja2 template: `system-context.md.j2` — C4 Level 1 system context with mermaid diagram
- [ ] Jinja2 template: `components.md.j2` — Component/bounded context map (adapts to methodology)
- [ ] Jinja2 template: `crosscutting.md.j2` — Cross-cutting concerns document
- [ ] Jinja2 template: `adr.md.j2` — Individual ADR in Michael Nygard format
- [ ] Jinja2 template: `architecture-index.md.j2` — ARCHITECTURE.md index linking all docs
- [ ] Output filename adapts: `bounded-contexts.md` for DDD, `components.md` otherwise
- [ ] Mermaid diagrams generated for system context and component map
- [ ] DDD sections (aggregate roots, domain events, context mapping) only in DDD methodology
- [ ] ADR files written to `docs/architecture/decisions/` subdirectory
- [ ] `docs/architecture/` directory created if not exists
- [ ] All output files have "Generated by /system-plan" header with date
- [ ] Unit tests: template rendering produces valid markdown
- [ ] Unit tests: DDD vs non-DDD content differences verified

## Files to Create

- `guardkit/planning/architecture_writer.py` — ArchitectureWriter class
- `guardkit/templates/system-context.md.j2` — System context template
- `guardkit/templates/components.md.j2` — Component map template (methodology-aware)
- `guardkit/templates/crosscutting.md.j2` — Crosscutting concerns template
- `guardkit/templates/adr.md.j2` — ADR template
- `guardkit/templates/architecture-index.md.j2` — Index template
- `tests/unit/planning/test_architecture_writer.py` — Unit tests

## Implementation Notes

- Jinja2 is already a dependency (used in `installer/core/commands/lib/templates/`)
- Template loading: use `jinja2.Environment(loader=PackageLoader("guardkit", "templates"))` or FileSystemLoader
- Mermaid syntax: `graph TB` for system context, `graph LR` for component map
- Follow spec templates in "Output Artefacts" section exactly
- Handle empty lists gracefully (no empty sections in output)
- `write_all()` should be synchronous (file I/O only, no Graphiti calls)

## Seam Test Points

- Templates render without Jinja2 errors for all entity combinations
- DDD entities produce `bounded-contexts.md`, modular entities produce `components.md`
- Generated markdown is valid (no unclosed tags, correct mermaid syntax)
- Empty entity lists don't produce broken output
