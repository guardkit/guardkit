---
id: TASK-MTS-004
title: Create server/index.ts.template
status: backlog
task_type: feature
created: 2026-01-24T16:45:00Z
updated: 2026-01-24T16:45:00Z
priority: high
tags: [template, mcp, typescript, server]
complexity: 4
parent_review: TASK-REV-4371
feature_id: FEAT-MTS
wave: 2
parallel_group: wave2
implementation_mode: task-work
conductor_workspace: mcp-ts-wave2-1
dependencies:
  - TASK-MTS-001  # manifest.json for placeholders
---

# Task: Create server/index.ts.template

## Description

Create the main server entry point template for MCP TypeScript projects. This is the most critical template as it establishes the correct patterns for server initialization, tool registration, and transport connection.

## Reference

Use `.claude/reviews/TASK-REV-4371-review-report.md` Section 3 for code patterns.
Use `docs/research/mcp-server-best-practices-2025.md` for TypeScript examples.

## Acceptance Criteria

- [ ] File created at `installer/core/templates/mcp-typescript/templates/server/index.ts.template`
- [ ] Uses McpServer from @modelcontextprotocol/sdk/server/mcp.js
- [ ] Uses StdioServerTransport from @modelcontextprotocol/sdk/server/stdio.js
- [ ] Imports Zod for schema validation
- [ ] Registers example tool BEFORE server.connect()
- [ ] Uses console.error() for logging (NEVER console.log)
- [ ] Includes proper TypeScript types
- [ ] Placeholders:
  - {{ServerName}}: Server identifier (kebab-case)
  - {{ServerVersion}}: Version string (default: 1.0.0)
  - {{Description}}: Server description

## Template Content

```typescript
/**
 * {{ServerName}} - MCP Server
 * {{Description}}
 *
 * Generated by GuardKit mcp-typescript template
 */

import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import * as z from 'zod';

// Initialize MCP server
const server = new McpServer({
    name: '{{ServerName}}',
    version: '{{ServerVersion}}'
});

// Register tools BEFORE calling connect()
// Example tool - replace with your implementations
server.registerTool(
    'hello-world',
    {
        title: 'Hello World',
        description: 'A simple greeting tool',
        inputSchema: {
            name: z.string().describe('Name to greet')
        }
    },
    async ({ name }) => ({
        content: [{
            type: 'text',
            text: `Hello, ${name}!`
        }]
    })
);

// Connect via STDIO transport
async function main() {
    const transport = new StdioServerTransport();
    await server.connect(transport);

    // CRITICAL: Log to stderr only (stdout = MCP protocol)
    console.error('{{ServerName}} started successfully');
}

main().catch((error) => {
    console.error('Fatal error:', error);
    process.exit(1);
});
```

## Critical Patterns Encoded

1. **McpServer class** - Not raw Server
2. **Tool registration before connect()** - Order matters
3. **stderr logging** - console.error only
4. **Zod validation** - Type-safe schemas
5. **Proper async/await** - Error handling

## Test Execution Log

[Automatically populated by /task-work]
