---
id: TASK-UX-2A61
title: Refactor figma-react-orchestrator to figma-orchestrator
status: backlog
created: 2025-11-11T10:50:00Z
updated: 2025-11-11T10:50:00Z
priority: high
tags: [ux-integration, orchestrator, refactoring]
complexity: 0
test_results:
  status: pending
  coverage: null
  last_run: null
---

# Task: Refactor figma-react-orchestrator to figma-orchestrator

## Description

Refactor the existing `figma-react-orchestrator.md` agent to be technology-agnostic by removing React-specific naming and making it capable of delegating to any stack's UI specialist.

This is part of Phase 2 of the Design URL Integration project (see [design-url-integration-implementation-guide.md](../../docs/proposals/design-url-integration-implementation-guide.md)).

## Acceptance Criteria

- [ ] Remove React-specific naming and references from orchestrator
- [ ] Make orchestrator technology-agnostic (delegates to any UI specialist)
- [ ] Update delegation pattern to accept stack parameter
- [ ] Keep 6-phase Saga pattern intact
- [ ] Update MCP integration (Figma)
- [ ] Update constraint validation to work with any stack
- [ ] File renamed: `figma-react-orchestrator.md` ‚Üí `figma-orchestrator.md`
- [ ] Agent name updated: `figma-react-orchestrator` ‚Üí `figma-orchestrator`
- [ ] Tests updated (if any exist)

## Implementation Notes

### Source and Target Files
- **Source**: `installer/global/agents/figma-react-orchestrator.md`
- **Target**: `installer/global/agents/figma-orchestrator.md`

### Key Changes Required

**1. Rename File**
```bash
mv installer/global/agents/figma-react-orchestrator.md \
   installer/global/agents/figma-orchestrator.md
```

**2. Update Agent Metadata**
```markdown
---
name: figma-orchestrator  # Was: figma-react-orchestrator
description: Orchestrates Figma design extraction and delegates to UI specialists  # Was: ...to React component generation
tools: Read, Write, Grep, mcp__figma-dev-mode__*
mcp_dependencies:
  - figma-dev-mode (required)
---
```

**3. Update Delegation Pattern**

**Before (React-specific)**:
```typescript
// Use Task tool to delegate to react-component-generator
const componentResult = await invokeAgent({
  agent: "react-component-generator",
  phase: "component-generation",
  // ...
});
```

**After (Technology-agnostic)**:
```typescript
// Use Task tool to delegate to {stack}-ui-specialist
const componentResult = await invokeAgent({
  agent: `${stack}-ui-specialist`,  // Parameterized by stack
  phase: "component-generation",
  input: {
    designElements: designElements,
    designConstraints: designConstraints,
    designMetadata: designMetadata,
  },
  instructions: `
    Generate component matching design exactly for ${stack} stack.

    Requirements:
    - Generate component in stack-appropriate format
    - Apply exact design styling
    - Implement ONLY properties for visible design elements
    - NO loading states, error states, or API integrations

    Constraints: ${JSON.stringify(designConstraints.prohibitions)}
  `
});
```

**4. Remove Stack-Specific Code Examples**

**Before (React-specific examples)**:
```typescript
// Generate TypeScript React component matching Figma design exactly.
// Use Tailwind CSS for styling (match design specs exactly)
// Implement ONLY props for visible design elements
```

**After (Generic examples)**:
```typescript
// Generate component matching Figma design exactly.
// Apply stack-appropriate styling (Tailwind, XAML, etc.)
// Implement ONLY props/properties for visible design elements
```

**5. Update Mission Statement**

**Before**:
> Execute a 6-phase Saga pattern workflow that extracts Figma designs, generates React components, and validates visual fidelity while enforcing strict constraint adherence (zero scope creep).

**After**:
> Execute a 6-phase Saga pattern workflow that extracts Figma designs, delegates component generation to stack-specific UI specialists, and validates visual fidelity while enforcing strict constraint adherence (zero scope creep).

**6. Update Success/Failure Reports**

Replace React-specific file paths with generic placeholders:

**Before**:
```markdown
üìÅ Generated Files
- src/components/FigmaComponent.tsx (183 lines)
- tests/FigmaComponent.visual.spec.ts (42 lines)
```

**After**:
```markdown
üìÅ Generated Files
- [Stack-appropriate component file] (generated by UI specialist)
- [Stack-appropriate test file] (generated by UI specialist)
```

### Existing 6-Phase Saga Pattern (Keep Intact)

- **Phase 0**: MCP Verification
- **Phase 1**: Design Extraction (via Figma MCP)
- **Phase 2**: Boundary Documentation (prohibition checklist)
- **Phase 3**: Component Generation (**delegates to UI specialist**)
- **Phase 4**: Visual Regression Testing (**delegates to UI specialist**)
- **Phase 5**: Constraint Validation (orchestrator validates)

### Delegation Interface

The orchestrator should pass to UI specialists:
```typescript
interface DesignContext {
  designElements: ExtractedElement[];
  designConstraints: ProhibitionChecklist;
  designMetadata: {
    source: "figma";
    nodeId: string;
    fileKey: string;
    extractedAt: string;
    visualReference: string;
  };
}
```

The orchestrator expects back from UI specialists:
```typescript
interface ComponentResult {
  generated_files: string[];
  visual_fidelity: number;  // 0.0-1.0
  constraint_violations: string[];
}
```

### Testing Strategy

**Unit Tests**:
- Test each phase independently with mocked delegation
- Verify MCP calls still work
- Verify constraint validation logic

**Integration Tests**:
- Full Saga execution with mock UI specialist
- Verify orchestrator passes correct context
- Verify orchestrator validates returned results

**Manual Testing**:
- Test with react-ui-specialist (after UX-005 is complete)
- Test with nextjs-ui-specialist (after UX-006 is complete)

## Test Requirements

- [ ] Unit test: MCP verification phase
- [ ] Unit test: Design extraction phase
- [ ] Unit test: Boundary documentation phase
- [ ] Unit test: Delegation to UI specialist (mocked)
- [ ] Unit test: Constraint validation phase
- [ ] Integration test: Full Saga with mocked UI specialist
- [ ] Integration test: Orchestrator passes correct design context
- [ ] Integration test: Orchestrator validates UI specialist results
- [ ] Edge case test: UI specialist returns violations
- [ ] Edge case test: UI specialist returns low visual fidelity

## Dependencies

**None** - This task can be developed in parallel with TASK-UX-004 (zeplin-orchestrator refactoring) using Conductor + git worktrees.

## Parallel Development

This task is marked for parallel development:

```bash
# Terminal 1
conductor start ux-figma-orchestrator main
cd .conductor/ux-figma-orchestrator
/task-work TASK-UX-2A61

# Terminal 2 (simultaneously)
conductor start ux-zeplin-orchestrator main
cd .conductor/ux-zeplin-orchestrator
/task-work TASK-UX-<zeplin-task-id>
```

## Next Steps

After completing this task:
1. TASK-UX-005: Extend react-ui-specialist to handle design contexts
2. TASK-UX-006: Extend nextjs-ui-specialist to handle design contexts
3. TASK-UX-007: Update task-work Phase 1 to load design URL
4. TASK-UX-008: Update task-work Phase 3 to route to orchestrators

## References

- [Design URL Integration Proposal](../../docs/proposals/design-url-integration-proposal.md)
- [Implementation Guide - Phase 2](../../docs/proposals/design-url-integration-implementation-guide.md#phase-2-refactor-orchestrators-parallel)
- [Existing Figma React Orchestrator](../../installer/global/agents/figma-react-orchestrator.md)

## Implementation Estimate

**Duration**: 3-4 hours

**Complexity**: 5/10 (Medium)
- Rename and refactor existing agent
- Update delegation pattern
- Remove stack-specific references
- Keep 6-phase Saga pattern intact
- Mostly refactoring, not new code

## Test Execution Log

_Automatically populated by /task-work_
