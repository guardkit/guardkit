# Docker Compose configuration for FalkorDB knowledge graph backend
#
# Services:
#   - falkordb: Graph database backend for Graphiti knowledge graph
#
# Note: The graphiti-core Python library is used directly instead of
# the Docker REST API (zepai/graphiti). This provides better control,
# error handling, and avoids token limit issues in the Docker image.
#
# Usage:
#   # Start services
#   docker compose -f docker/docker-compose.graphiti.yml up -d
#
#   # View logs
#   docker compose -f docker/docker-compose.graphiti.yml logs -f
#
#   # Stop services
#   docker compose -f docker/docker-compose.graphiti.yml down
#
#   # Stop and remove volumes (clean slate)
#   docker compose -f docker/docker-compose.graphiti.yml down -v
#
# Requirements:
#   - Docker and Docker Compose installed
#   - OPENAI_API_KEY environment variable set (for graphiti-core embeddings)
#
# Access:
#   - FalkorDB Browser: http://localhost:3000
#   - FalkorDB (Redis protocol): localhost:6379
#
# Python Usage:
#   from guardkit.knowledge.graphiti_client import GraphitiClient, GraphitiConfig
#
#   config = GraphitiConfig(
#       graph_store="falkordb",
#       falkordb_host="localhost",
#       falkordb_port=6379
#   )
#   client = GraphitiClient(config)
#   await client.initialize()

services:
  falkordb:
    image: falkordb/falkordb:latest
    container_name: guardkit-falkordb
    ports:
      - "6379:6379"   # Redis protocol (FalkorDB connection)
      - "3000:3000"   # FalkorDB Browser UI
    volumes:
      - falkordb_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped
    networks:
      - guardkit-knowledge

volumes:
  falkordb_data:
    driver: local

networks:
  guardkit-knowledge:
    driver: bridge
