# Review Report: TASK-REV-C809

## Executive Summary

The `/feature-build` command failed during feature validation for FEAT-4C22 ("Structured JSON Logging") because task `TASK-LOG-003` declares a dependency on `TASK-DOC-001`, which does not exist in the feature definition. This is a **configuration error** in the feature YAML file, not a bug in the validation logic.

**Root Cause**: The feature YAML file references a task ID (`TASK-DOC-001`) that was either:
1. Mistyped during feature creation
2. Removed from the feature but not removed from dependency declarations
3. Intended to be a different task ID

**Severity**: Low (configuration error, not code defect)

**Status**: Validation working as designed

---

## Review Details

| Field | Value |
|-------|-------|
| **Mode** | Architectural Review |
| **Depth** | Standard |
| **Reviewer** | task-review workflow |
| **Date** | 2026-01-25 |

---

## Findings

### Finding 1: Validation Logic is Correct

**Evidence**: The validation error originates from [feature_loader.py:614-620](guardkit/orchestrator/feature_loader.py#L614-L620):

```python
# Check dependencies are valid
for task in feature.tasks:
    for dep_id in task.dependencies:
        if dep_id not in all_task_ids:
            errors.append(
                f"Task {task.id} has unknown dependency: {dep_id}"
            )
```

This correctly iterates through all tasks, checks each dependency, and validates that the referenced task ID exists in the feature's task list.

**Impact**: None - validation is working as designed.

### Finding 2: Feature File Has Invalid Configuration

**Evidence**: From the failure log ([logging_feature_fails.md](docs/reviews/feature-build/logging_feature_fails.md)):

```
Feature validation failed for FEAT-4C22:
  - Task TASK-LOG-003 has unknown dependency: TASK-DOC-001
```

The feature contains 6 tasks in 5 waves. The task `TASK-LOG-003` references `TASK-DOC-001` as a dependency, but `TASK-DOC-001` is not defined in the feature.

**Impact**: Feature cannot execute until the configuration is corrected.

### Finding 3: No Similar Task ID Suggestions

**Observation**: The current error message does not suggest similar task IDs that might be what the user intended. For example, if the feature contains `TASK-LOG-001`, the system could suggest "Did you mean TASK-LOG-001?".

**Impact**: Minor UX improvement opportunity.

### Finding 4: Error Message is Clear

**Evidence**: The error message clearly states:
- Which task has the problem (`TASK-LOG-003`)
- What the problem is (`has unknown dependency`)
- What the invalid dependency is (`TASK-DOC-001`)

**Impact**: Positive - users can quickly identify the issue.

---

## Root Cause Analysis

### Q1: Is TASK-DOC-001 missing from the feature definition or is it a typo?

**Answer**: This cannot be determined from the available logs. The feature file (`.guardkit/features/FEAT-4C22.yaml`) exists in a test repository at `/Users/richardwoollcott/Projects/guardkit_testing/feature-test/`, which is not the main GuardKit repository being reviewed.

**Likely scenarios**:
1. **Typo**: `TASK-DOC-001` should have been `TASK-LOG-001` or another existing task
2. **Removed task**: `TASK-DOC-001` was originally planned but removed, and the dependency reference was not updated
3. **Wrong prefix**: The task ID prefix should be `LOG` not `DOC`

### Q2: Should validation suggest similar task IDs when an unknown dependency is found?

**Answer**: Yes, this would improve UX. Implementation could use:
- Levenshtein distance for typo detection
- Prefix matching for wrong-prefix suggestions
- List of valid task IDs in the error message

### Q3: Is the feature file auto-generated or manually created?

**Answer**: Feature files are generated by `/feature-plan` command. The `/feature-plan` command creates the YAML from review recommendations. If there's a bug, it's in the feature generation logic, not validation.

### Q4: What is the expected dependency chain for TASK-LOG-003?

**Answer**: Unknown without access to the actual feature file. Based on the naming convention (`TASK-LOG-003`), it likely depends on `TASK-LOG-001` or `TASK-LOG-002`.

---

## Recommendations

### Recommendation 1: Fix the Feature Configuration (Immediate)

**Action**: Edit `.guardkit/features/FEAT-4C22.yaml` in the test repository:

1. Locate `TASK-LOG-003` in the tasks list
2. Review its `dependencies` field
3. Replace `TASK-DOC-001` with the correct task ID (likely `TASK-LOG-001` or `TASK-LOG-002`)

**Priority**: High (blocking feature execution)

### Recommendation 2: Add Similar Task ID Suggestions (Optional Enhancement)

**Action**: Enhance [feature_loader.py:614-620](guardkit/orchestrator/feature_loader.py#L614-L620) to suggest similar task IDs:

```python
# Potential enhancement (not implemented)
if dep_id not in all_task_ids:
    similar = find_similar_ids(dep_id, all_task_ids)
    suggestion = f" Did you mean: {', '.join(similar)}?" if similar else ""
    errors.append(
        f"Task {task.id} has unknown dependency: {dep_id}.{suggestion}"
    )
```

**Priority**: Low (nice-to-have UX improvement)

### Recommendation 3: Review Feature Generation Logic (If Recurring)

**Action**: If this error pattern recurs, review the `/feature-plan` command's subtask generation to ensure dependency references are always valid.

**Priority**: Medium (only if pattern recurs)

---

## Answers to Review Questions

| Question | Answer |
|----------|--------|
| Is TASK-DOC-001 missing or a typo? | Likely a typo - the prefix "DOC" doesn't match the feature's "LOG" naming pattern |
| Should validation suggest similar task IDs? | Yes, would improve UX |
| Is the feature file auto-generated? | Yes, via `/feature-plan` |
| Expected dependency chain for TASK-LOG-003? | Unknown; likely `TASK-LOG-001` or `TASK-LOG-002` |

---

## Conclusion

The feature validation failure is **working correctly** - it's detecting an invalid configuration in the feature YAML file. The fix is straightforward: edit the feature file to correct the invalid dependency reference.

**Validation Logic Score**: 100/100 (no bugs found)
**Error Message Clarity**: 90/100 (clear but could suggest alternatives)
**UX Enhancement Opportunity**: Add similar task ID suggestions

---

## Appendix

### A. Validation Logic Location

- **File**: [guardkit/orchestrator/feature_loader.py](guardkit/orchestrator/feature_loader.py)
- **Method**: `FeatureLoader.validate_feature()`
- **Lines**: 564-627

### B. Test Coverage

The validation logic is well-tested:
- [test_validate_feature_unknown_dependency](tests/unit/test_feature_loader.py#L322-L330) - Tests unknown dependency detection
- [test_detect_circular_dependency_simple](tests/unit/test_feature_loader.py#L338-L379) - Tests circular dependency detection

### C. Related Files

- [guardkit/orchestrator/feature_orchestrator.py](guardkit/orchestrator/feature_orchestrator.py) - Uses FeatureLoader for validation
- [guardkit/cli/autobuild.py](guardkit/cli/autobuild.py) - CLI entry point that displays validation errors
