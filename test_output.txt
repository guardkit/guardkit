============================= test session starts ==============================
platform darwin -- Python 3.14.0, pytest-8.4.2, pluggy-1.6.0 -- /opt/homebrew/opt/python@3.14/bin/python3.14
cachedir: .pytest_cache
rootdir: /Users/richardwoollcott/Projects/appmilla_github/taskwright/.conductor/hangzhou-v2
configfile: pytest.ini
plugins: cov-7.0.0
collecting ... collected 39 items

tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_initialization PASSED [  2%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_initialization_with_custom_ai_client PASSED [  5%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_generate_empty_analysis PASSED [  7%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_generate_with_max_templates PASSED [ 10%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_extract_placeholders_from_content PASSED [ 12%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_extract_placeholders_no_placeholders PASSED [ 15%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_infer_language_csharp PASSED [ 17%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_infer_language_typescript PASSED [ 20%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_infer_language_python PASSED [ 23%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_infer_language_unknown PASSED [ 25%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_infer_template_path_with_layer PASSED [ 28%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_infer_template_path_fallback PASSED [ 30%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_create_template_name PASSED [ 33%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_identify_patterns_result_type PASSED [ 35%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_identify_patterns_async_await PASSED [ 38%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_identify_patterns_repository PASSED [ 41%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_identify_patterns_existing_patterns PASSED [ 43%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_validate_template_valid PASSED [ 46%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_validate_template_empty_content PASSED [ 48%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_validate_template_invalid_placeholder_format PASSED [ 51%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_validate_template_no_placeholders_warning PASSED [ 53%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_template_deduplication PASSED [ 56%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_template_hash PASSED [ 58%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_count_by_type PASSED [ 61%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_save_templates PASSED [ 64%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_parse_ai_response_with_placeholders PASSED [ 66%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_parse_ai_response_without_placeholders_section PASSED [ 69%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_fallback_placeholder_extraction_csharp PASSED [ 71%]
tests/lib/template_generator/test_template_generator.py::TestTemplateGenerator::test_create_extraction_prompt PASSED [ 74%]
tests/lib/template_generator/test_template_generator.py::TestMockAIClient::test_mock_client_csharp PASSED [ 76%]
tests/lib/template_generator/test_template_generator.py::TestMockAIClient::test_mock_client_typescript PASSED [ 79%]
tests/lib/template_generator/test_template_generator.py::TestMockAIClient::test_mock_client_python PASSED [ 82%]
tests/lib/template_generator/test_template_generator.py::TestMockAIClient::test_mock_client_analyze_code PASSED [ 84%]
tests/lib/template_generator/test_template_generator.py::TestMockAIClient::test_mock_client_extract_patterns FAILED [ 87%]
tests/lib/template_generator/test_template_generator.py::TestTemplateCollection::test_template_collection_creation PASSED [ 89%]
tests/lib/template_generator/test_template_generator.py::TestTemplateCollection::test_template_collection_empty PASSED [ 92%]
tests/lib/template_generator/test_template_generator.py::TestValidationResult::test_validation_result_valid PASSED [ 94%]
tests/lib/template_generator/test_template_generator.py::TestValidationResult::test_validation_result_with_errors PASSED [ 97%]
tests/lib/template_generator/test_template_generator.py::TestValidationResult::test_validation_result_with_warnings PASSED [100%]

=================================== FAILURES ===================================
______________ TestMockAIClient.test_mock_client_extract_patterns ______________
tests/lib/template_generator/test_template_generator.py:662: in test_mock_client_extract_patterns
    assert "Async/await" in patterns
E   AssertionError: assert 'Async/await' in ['Result type pattern']
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.14.0-final-0 _______________

Name                                                            Stmts   Miss Branch BrPart  Cover   Missing
-----------------------------------------------------------------------------------------------------------
installer/global/lib/__init__.py                                    0      0      0      0   100%
installer/global/lib/agent_generator/__init__.py                    2      2      0      0     0%   12-20
installer/global/lib/agent_generator/agent_generator.py           150    150     54      0     0%   8-470
installer/global/lib/agent_scanner/__init__.py                      2      2      0      0     0%   12-18
installer/global/lib/agent_scanner/agent_scanner.py                87     87     36      0     0%   8-256
installer/global/lib/codebase_analyzer/__init__.py                  5      0      0      0   100%
installer/global/lib/codebase_analyzer/agent_invoker.py           171    145     92      0    10%   64-70, 79, 100-136, 152-175, 194, 204-218, 266-287, 291-334, 338-354, 358-369, 373-375, 379-386, 390-408, 413-426, 430-449, 453-458, 462-477
installer/global/lib/codebase_analyzer/ai_analyzer.py             100     81     24      0    15%   75-82, 107-191, 209-220, 239-262, 283-291, 308-318, 335, 347, 375-376
installer/global/lib/codebase_analyzer/models.py                   86     14     14      4    76%   43, 45, 47, 49, 131-146, 154
installer/global/lib/codebase_analyzer/prompt_builder.py          138    119     62      0    10%   34, 57-79, 83-104, 108, 118-140, 144, 224-247, 260-262, 298-302, 315-366, 378-380, 391-407, 411-430, 434-440, 453-463
installer/global/lib/codebase_analyzer/response_parser.py          92     77     26      0    13%   60-74, 92-118, 138-190, 194-214, 222-234, 238, 256-285, 313-325
installer/global/lib/codebase_analyzer/serializer.py              137    122     50      0     8%   36-42, 58-79, 94-112, 124-132, 144-149, 164-171, 186-207, 223-234, 238-362
installer/global/lib/config/__init__.py                             4      4      0      0     0%   2-6
installer/global/lib/config/config_schema.py                       58     58      8      0     0%   2-117
installer/global/lib/config/defaults.py                             2      2      0      0     0%   2-5
installer/global/lib/config/plan_review_config.py                 120    120     50      0     0%   2-297
installer/global/lib/feature_detection.py                          80     80     22      0     0%   51-300
installer/global/lib/metrics/__init__.py                            3      3      0      0     0%   2-5
installer/global/lib/metrics/metrics_storage.py                    80     80     24      0     0%   2-164
installer/global/lib/metrics/plan_review_dashboard.py             133    133     52      0     0%   2-264
installer/global/lib/metrics/plan_review_metrics.py                33     33      8      0     0%   2-197
installer/global/lib/template_generator/__init__.py                 5      0      0      0   100%
installer/global/lib/template_generator/ai_client.py               45      9     14      4    75%   47-59, 78, 94, 128, 214, 254->257, 258, 261
installer/global/lib/template_generator/models.py                  40      0      0      0   100%
installer/global/lib/template_generator/template_generator.py     244     75    130     25    61%   63->59, 69-73, 99-100, 105-107, 111->115, 122-124, 127, 141, 146, 195-199, 281->290, 286->288, 323->335, 330->335, 371->367, 379-380, 404->408, 409->412, 413->416, 417-418, 421-422, 425->428, 429-430, 433-434, 439-457, 494->498, 513-524, 605-634, 647-648
installer/global/lib/utils/__init__.py                              4      4      0      0     0%   2-6
installer/global/lib/utils/file_operations.py                      51     51      2      0     0%   2-117
installer/global/lib/utils/json_serializer.py                      36     36      2      0     0%   2-97
installer/global/lib/utils/path_resolver.py                        28     28      6      0     0%   2-81
-----------------------------------------------------------------------------------------------------------
TOTAL                                                            1936   1515    676     33    19%
Coverage JSON written to file coverage.json
=========================== short test summary info ============================
FAILED tests/lib/template_generator/test_template_generator.py::TestMockAIClient::test_mock_client_extract_patterns - AssertionError: assert 'Async/await' in ['Result type pattern']
========================= 1 failed, 38 passed in 0.41s =========================
